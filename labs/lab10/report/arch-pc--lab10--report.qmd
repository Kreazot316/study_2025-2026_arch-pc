---
## Author
author:
  name: Карпухин Клим
  email: 1032255580@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: "Отчёт по лабораторной работе No10"
subtitle: "Работа с файлами средствами NASM"
license: "CC BY"
---

# Цель работы

Цель лабораторной работы №10 — приобрести навыки написания программ для работы с файлами на языке ассемблера NASM под ОС GNU/Linux: создание, открытие, чтение и запись файлов, изменение их содержимого и прав доступа.

# Выполнение лабораторной работы

## Создание каталога и файлов для работы

Создал каталог для программ лабораторной работы №10, перешёл в него и создал файлы `lab10-1.asm` и `readme.txt` ([рис. @fig-001]).

![Создание каталога для программ лабораторной работы №10 и файлов lab10-1.asm и readme.txt](image/1.jpg){#fig-001 width=70%}

## Программа записи введённой строки в файл

### Ввод программы из листинга 10.1

Ввёл в файл `lab10-1.asm` текст программы из листинга 10.1, реализующей запись строки, введённой с клавиатуры, в файл `readme-1.txt` ([рис. @fig-002]).

![Текст программы lab10-1.asm из листинга 10.1](image/2.jpg){#fig-002 width=70%}

### Трансляция, компоновка и проверка работы программы

Собрал, скомпоновал и выполнил программу ([рис. @fig-003]).

![Трансляция и компоновка программы lab10-1.asm](image/3.jpg){#fig-003 width=70%}

Проверил содержимое файла `readme-1.txt` командами `ls` и `cat`. В файле `readme.txt` появилась введённая строка ([рис. @fig-004]).

![Запуск программы lab10-1 и проверка содержимого файла readme-1.txt](image/4.jpg){#fig-004 width=70%}

Программа корректно выводит приглашение, считывает строку с клавиатуры, вычисляет её длину и записывает эту строку в конец файла `readme-1.txt`.

## Изменение прав доступа к исполняемому файлу lab10-1

Запретил выполнение для всех категорий пользователей ([рис. @fig-005]).

![Изменение прав доступа к исполняемому файлу lab10-1: запрет выполнения](image/5.jpg){#fig-005 width=70%}

При попытке выполнить файл система выводит сообщение:

```bash
bash: ./lab10-1: Permission denied
```
([рис. @fig-006]).

![Попытка выполнить файл](image/6.jpg){#fig-006 width=70%}

Это происходит потому, что у файла больше нет права на исполнение (`x`) ни для владельца, ни для группы, ни для остальных пользователей, и ядро отказывает в запуске файла как программы.

## Изменение прав доступа к исходному файлу lab10-1.asm

Изменил права доступа к исходному файлу `lab10-1.asm`, добавив право на исполнение ([рис. @fig-007]).

![Добавление права на исполнение для файла lab10-1.asm](image/7.jpg){#fig-007 width=70%}

Попытка выполнить файл как программу приводит к серии ошибок, вызванных тем, что интерпретатор `bash` попытался выполнить содержимое файла как shell-скрипт и выдал серию сообщений, так как `lab10-1.asm` является текставым кодом с исходным кодом NASM, а не исполняемым ELF-файлом. Формат файла должен быть поддерживаемым форматом исполняемых файлов ([рис. @fig-008]).

![Попытка выполнить файл](image/8.jpg){#fig-008 width=70%}

## Настройка прав доступа для readme-1.txt и readme-2.txt (вариант 8)

Согласно заданию, для моего варианта (No 1) необходимо задать права доступа к файлам `readme-1.txt` и `readme-2.txt` в разных представлениях (символьном и двоичном) по таблице 10.4.

### Права доступа к readme-1.txt в символьном виде

Для варианта 1 в символьном виде заданы права:

```bash
--x -wx rwx
```

Назначил такие права и проверил правильность выполнения команды ([рис. @fig-009]).

![Назначение прав --x -wx rwx для файла readme-1.txt](image/9.jpg){#fig-009 width=70%}

### Права доступа к readme-2.txt в двоичном виде

Для того же варианта 1 указаны права в двоичной форме:

```bash
000 110 010
```

Разбиваем:

* `000` → `---` (нет прав) — права остальных.
* `110` → `rw-` (чтение и запись) — права группы.
* `010` → `-w-` (только запись) — права владельца.



В восьмеричном представлении это соответствует `062`. Назначил такие права и проверил правильность выполнения команды ([рис. @fig-010]).

![Назначение прав 010 001 000 (восьмерично 210) для файла readme-2.txt](image/10.jpg){#fig-010 width=70%}

Права файлов `readme-1.txt` и `readme-2.txt`, выведенные командой `ls -l`, совпадают с теми, что заданы в таблице для выбранного варианта.

# Задание для самостоятельной работы
S
## Реализация программы `lab10-task1.asm`

Создал файл `lab10-task1.asm` и реализовал описанный алгоритм с использованием системных вызовов `sys_creat`, `sys_write` и `sys_close` и процедур из `in_out.asm`.

Текст программы показан на скриншоте ([рис. @fig-011]).

![Текст программы lab10-task1.asm для создания файла name.txt и записи фамилии и имени](image/11.jpg){#fig-011 width=70%}

## Сборка, запуск и проверка результата

Собрал и запустил программу, проверил наличие файла `name.txt` и его содержимое ([рис. @fig-012]).

![Сборка и запуск программы lab10-task1, проверка существования файла name.txt и его содержимого](image/12.jpg){#fig-012 width=70%}

Программа корректно создаёт файл `name.txt`, записывает в него фиксированную фразу «Меня зовут», а затем дописывает введённые с клавиатуры фамилию и имя.

# Выводы

В ходе выполнения лабораторной работы №10 были получены следующие результаты:

* изучены механизмы задания прав доступа к файлам в ОС GNU/Linux в символьном и числовом (восьмеричном и двоичном) представлениях;
* на практике применены команды `chmod` и `ls -l` для изменения и проверки прав доступа к обычным файлам и исполняемым программам;
* реализована и протестирована программа на языке ассемблера NASM, выполняющая запись строки, введённой пользователем, в файл с использованием системных вызовов `sys_open`, `sys_write` и `sys_close`;
* показано, что наличие бита исполнения у файла с исходным кодом (`*.asm`) не делает его исполняемым в смысле формата ELF, что приводит к ошибке `Exec format error` при попытке запуска;
* для файлов `readme-1.txt` и `readme-2.txt` корректно заданы права доступа согласно варианту 8, что подтверждено выводом команды `ls -l`;
* в задании для самостоятельной работы реализована программа создания файла `name.txt` и записи в него текста вида «Меня зовут <ФИО>», что позволило закрепить навыки использования системных вызовов `sys_creat`, `sys_write` и `sys_close`.

Таким образом, цель работы — приобретение навыков работы с файлами средствами NASM и управления правами доступа в ОС GNU/Linux — достигнута.
